#include <Wire.h> //This is for i2C
#include <AS5600.h>

AS5600 as5600(&Wire);
#define SDA 21
#define SCL 22

AS5600 as5600_2(&Wire1);
#define SDA_2 18
#define SCL_2 19


#define stepPin 33 
#define dirPin 25
#include <AccelStepper.h>
AccelStepper stepper1(1, stepPin, dirPin);


//PID parameters - tuned by the user
float proportional = 100; //1.35; //k_pp
float integral = 0.000005;//0.00005; //k_i 
float derivative = 0.01; //k_d 
float controlSignal = 0; //u 
//-----------------------------------
//-----------------------------------
//PID-related
float pT[2] = {0, 0}; // previousTime, for calculating delta t
float pE[2] = {0, 0}; //previousError for calculating the derivative (edot)
float eI[2] = {0,0}; // errorIntegral
float cT[2] = {0,0}; //currentTime, time in the moment of calculation
float dT[2] = {0,0}; //deltaTime, time difference
float eV[2] = {0,0}; //errorValue, error
float ed[2] = {0,0}; // edot, derivative (de/dt)

float globalAngles[2] = {0.0, 0.0};
float preloaded_trajectory[1499][2] = {
{0, 0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 0.0},
{0.0, 1e-05},
{0.0, 2e-05},
{0.0, 3e-05},
{0.0, 4e-05},
{0.0, 5e-05},
{0.0, 7e-05},
{0.0, 9e-05},
{0.0, 0.00011},
{0.0, 0.00013},
{0.0, 0.00015},
{0.0, 0.00017},
{0.0, 0.0002},
{0.0, 0.00023},
{0.0, 0.00026},
{0.0, 0.0003},
{0.0, 0.00034},
{0.0, 0.00038},
{0.0, 0.00043},
{0.0, 0.00048},
{0.0, 0.00053},
{0.0, 0.00059},
{0.0, 0.00065},
{0.0, 0.00072},
{0.0, 0.00079},
{0.0, 0.00086},
{0.0, 0.00094},
{0.0, 0.00102},
{0.0, 0.00111},
{0.0, 0.0012},
{0.0, 0.0013},
{0.0, 0.0014},
{0.0, 0.00151},
{0.0, 0.00162},
{0.0, 0.00174},
{0.0, 0.00186},
{0.0, 0.00199},
{0.0, 0.00212},
{0.0, 0.00226},
{0.0, 0.0024},
{0.0, 0.00255},
{0.0, 0.0027},
{0.0, 0.00286},
{0.0, 0.00303},
{0.0, 0.0032},
{0.0, 0.00338},
{0.0, 0.00356},
{0.0, 0.00375},
{0.0, 0.00394},
{0.0, 0.00414},
{0.0, 0.00435},
{0.0, 0.00456},
{0.0, 0.00478},
{0.0, 0.00501},
{0.0, 0.00524},
{0.0, 0.00548},
{0.0, 0.00572},
{0.0, 0.00597},
{0.0, 0.00623},
{0.0, 0.00649},
{0.0, 0.00676},
{0.0, 0.00704},
{0.0, 0.00732},
{0.0, 0.00761},
{0.0, 0.00791},
{0.0, 0.00822},
{0.0, 0.00853},
{0.0, 0.00885},
{0.0, 0.00918},
{0.0, 0.00951},
{0.0, 0.00985},
{1e-05, 0.0102},
{2e-05, 0.01056},
{3e-05, 0.01092},
{4e-05, 0.01129},
{5e-05, 0.01167},
{6e-05, 0.01205},
{7e-05, 0.01244},
{8e-05, 0.01284},
{9e-05, 0.01325},
{0.0001, 0.01366},
{0.00011, 0.01408},
{0.00012, 0.01451},
{0.00013, 0.01494},
{0.00014, 0.01538},
{0.00015, 0.01583},
{0.00016, 0.01628},
{0.00017, 0.01674},
{0.00018, 0.01721},
{0.00019, 0.01769},
{0.0002, 0.01817},
{0.00021, 0.01866},
{0.00022, 0.01916},
{0.00023, 0.01967},
{0.00024, 0.02018},
{0.00025, 0.0207},
{0.00026, 0.02123},
{0.00028, 0.02176},
{0.0003, 0.0223},
{0.00032, 0.02285},
{0.00034, 0.02341},
{0.00036, 0.02397},
{0.00038, 0.02454},
{0.0004, 0.02512},
{0.00042, 0.0257},
{0.00044, 0.02629},
{0.00046, 0.02689},
{0.00048, 0.02749},
{0.0005, 0.0281},
{0.00052, 0.02872},
{0.00054, 0.02934},
{0.00057, 0.02997},
{0.0006, 0.03061},
{0.00063, 0.03125},
{0.00066, 0.0319},
{0.00069, 0.03256},
{0.00072, 0.03323},
{0.00075, 0.0339},
{0.00078, 0.03458},
{0.00081, 0.03527},
{0.00084, 0.03596},
{0.00087, 0.03666},
{0.00091, 0.03736},
{0.00095, 0.03807},
{0.00099, 0.03879},
{0.00103, 0.03951},
{0.00107, 0.04024},
{0.00111, 0.04098},
{0.00115, 0.04172},
{0.00119, 0.04247},
{0.00124, 0.04323},
{0.00129, 0.04399},
{0.00134, 0.04476},
{0.00139, 0.04553},
{0.00144, 0.04631},
{0.00149, 0.04709},
{0.00154, 0.04788},
{0.00159, 0.04868},
{0.00165, 0.04948},
{0.00171, 0.05029},
{0.00177, 0.0511},
{0.00183, 0.05192},
{0.00189, 0.05274},
{0.00195, 0.05357},
{0.00201, 0.0544},
{0.00208, 0.05524},
{0.00215, 0.05608},
{0.00222, 0.05693},
{0.00229, 0.05778},
{0.00236, 0.05864},
{0.00243, 0.0595},
{0.00251, 0.06037},
{0.00259, 0.06124},
{0.00267, 0.06212},
{0.00275, 0.063},
{0.00283, 0.06389},
{0.00291, 0.06478},
{0.003, 0.06567},
{0.00309, 0.06657},
{0.00318, 0.06747},
{0.00327, 0.06838},
{0.00336, 0.06929},
{0.00345, 0.07021},
{0.00355, 0.07113},
{0.00365, 0.07205},
{0.00375, 0.07298},
{0.00385, 0.07391},
{0.00395, 0.07484},
{0.00406, 0.07578},
{0.00417, 0.07672},
{0.00428, 0.07767},
{0.00439, 0.07862},
{0.0045, 0.07957},
{0.00462, 0.08053},
{0.00474, 0.08149},
{0.00486, 0.08245},
{0.00498, 0.08342},
{0.0051, 0.08439},
{0.00523, 0.08536},
{0.00536, 0.08633},
{0.00549, 0.08731},
{0.00562, 0.08829},
{0.00576, 0.08927},
{0.0059, 0.09025},
{0.00604, 0.09124},
{0.00618, 0.09223},
{0.00632, 0.09322},
{0.00647, 0.09421},
{0.00662, 0.09521},
{0.00677, 0.09621},
{0.00692, 0.09721},
{0.00708, 0.09821},
{0.00724, 0.09921},
{0.0074, 0.10021},
{0.00756, 0.10122},
{0.00772, 0.10223},
{0.00789, 0.10324},
{0.00806, 0.10425},
{0.00823, 0.10526},
{0.0084, 0.10627},
{0.00858, 0.10728},
{0.00876, 0.1083},
{0.00894, 0.10932},
{0.00912, 0.11034},
{0.0093, 0.11136},
{0.00949, 0.11238},
{0.00968, 0.1134},
{0.00987, 0.11442},
{0.01006, 0.11544},
{0.01026, 0.11646},
{0.01046, 0.11748},
{0.01066, 0.1185},
{0.01086, 0.11952},
{0.01107, 0.12054},
{0.01128, 0.12156},
{0.01149, 0.12258},
{0.0117, 0.1236},
{0.01192, 0.12462},
{0.01214, 0.12564},
{0.01236, 0.12666},
{0.01258, 0.12768},
{0.0128, 0.1287},
{0.01303, 0.12972},
{0.01326, 0.13074},
{0.01349, 0.13176},
{0.01372, 0.13278},
{0.01396, 0.1338},
{0.0142, 0.13482},
{0.01444, 0.13584},
{0.01468, 0.13685},
{0.01492, 0.13786},
{0.01517, 0.13887},
{0.01542, 0.13988},
{0.01567, 0.14089},
{0.01592, 0.1419},
{0.01618, 0.14291},
{0.01644, 0.14392},
{0.0167, 0.14492},
{0.01696, 0.14592},
{0.01722, 0.14692},
{0.01749, 0.14792},
{0.01776, 0.14892},
{0.01803, 0.14992},
{0.0183, 0.15091},
{0.01858, 0.1519},
{0.01886, 0.15289},
{0.01914, 0.15388},
{0.01942, 0.15486},
{0.0197, 0.15584},
{0.01999, 0.15682},
{0.02028, 0.1578},
{0.02057, 0.15878},
{0.02086, 0.15975},
{0.02115, 0.16072},
{0.02144, 0.16169},
{0.02174, 0.16265},
{0.02204, 0.16361},
{0.02234, 0.16457},
{0.02264, 0.16553},
{0.02294, 0.16648},
{0.02325, 0.16743},
{0.02356, 0.16838},
{0.02387, 0.16933},
{0.02418, 0.17027},
{0.02449, 0.17121},
{0.0248, 0.17215},
{0.02511, 0.17308},
{0.02543, 0.17401},
{0.02575, 0.17494},
{0.02607, 0.17586},
{0.02639, 0.17678},
{0.02671, 0.1777},
{0.02703, 0.17861},
{0.02735, 0.17952},
{0.02768, 0.18043},
{0.02801, 0.18133},
{0.02834, 0.18223},
{0.02867, 0.18312},
{0.029, 0.18401},
{0.02933, 0.1849},
{0.02966, 0.18578},
{0.02999, 0.18666},
{0.03033, 0.18753},
{0.03067, 0.1884},
{0.03101, 0.18927},
{0.03135, 0.19013},
{0.03169, 0.19099},
{0.03203, 0.19184},
{0.03237, 0.19269},
{0.03271, 0.19353},
{0.03305, 0.19437},
{0.03339, 0.19521},
{0.03373, 0.19604},
{0.03407, 0.19687},
{0.03442, 0.19769},
{0.03476, 0.19851},
{0.03511, 0.19933},
{0.03546, 0.20014},
{0.03581, 0.20094},
{0.03616, 0.20174},
{0.03651, 0.20254},
{0.03686, 0.20333},
{0.03721, 0.20412},
{0.03756, 0.2049},
{0.03791, 0.20568},
{0.03826, 0.20645},
{0.03861, 0.20722},
{0.03896, 0.20798},
{0.03931, 0.20874},
{0.03966, 0.20949},
{0.04001, 0.21024},
{0.04036, 0.21098},
{0.04071, 0.21172},
{0.04106, 0.21245},
{0.04141, 0.21318},
{0.04176, 0.2139},
{0.04211, 0.21462},
{0.04246, 0.21533},
{0.04281, 0.21604},
{0.04316, 0.21674},
{0.04351, 0.21744},
{0.04385, 0.21813},
{0.04419, 0.21882},
{0.04453, 0.2195},
{0.04487, 0.22018},
{0.04521, 0.22085},
{0.04555, 0.22152},
{0.04589, 0.22218},
{0.04623, 0.22284},
{0.04657, 0.22349},
{0.04691, 0.22413},
{0.04725, 0.22477},
{0.04759, 0.22541},
{0.04792, 0.22604},
{0.04825, 0.22666},
{0.04858, 0.22728},
{0.04891, 0.22789},
{0.04924, 0.2285},
{0.04957, 0.2291},
{0.0499, 0.2297},
{0.05023, 0.23029},
{0.05056, 0.23088},
{0.05088, 0.23146},
{0.0512, 0.23204},
{0.05152, 0.23261},
{0.05184, 0.23317},
{0.05216, 0.23373},
{0.05248, 0.23428},
{0.05279, 0.23483},
{0.0531, 0.23537},
{0.05341, 0.23591},
{0.05372, 0.23644},
{0.05403, 0.23697},
{0.05434, 0.23749},
{0.05464, 0.23801},
{0.05494, 0.23852},
{0.05524, 0.23903},
{0.05554, 0.23953},
{0.05584, 0.24002},
{0.05613, 0.24051},
{0.05642, 0.24099},
{0.05671, 0.24147},
{0.057, 0.24194},
{0.05729, 0.24241},
{0.05757, 0.24287},
{0.05785, 0.24333},
{0.05813, 0.24378},
{0.05841, 0.24423},
{0.05869, 0.24467},
{0.05896, 0.24511},
{0.05923, 0.24554},
{0.0595, 0.24596},
{0.05977, 0.24638},
{0.06003, 0.24679},
{0.06029, 0.2472},
{0.06055, 0.2476},
{0.06081, 0.248},
{0.06106, 0.24839},
{0.06131, 0.24878},
{0.06156, 0.24916},
{0.0618, 0.24954},
{0.06204, 0.24991},
{0.06228, 0.25028},
{0.06252, 0.25064},
{0.06275, 0.251},
{0.06298, 0.25135},
{0.06321, 0.2517},
{0.06344, 0.25204},
{0.06366, 0.25237},
{0.06388, 0.2527},
{0.0641, 0.25302},
{0.06432, 0.25334},
{0.06453, 0.25365},
{0.06474, 0.25396},
{0.06495, 0.25426},
{0.06515, 0.25456},
{0.06535, 0.25485},
{0.06555, 0.25514},
{0.06575, 0.25542},
{0.06594, 0.2557},
{0.06613, 0.25597},
{0.06632, 0.25624},
{0.0665, 0.25651},
{0.06668, 0.25677},
{0.06686, 0.25702},
{0.06704, 0.25727},
{0.06721, 0.25751},
{0.06738, 0.25775},
{0.06755, 0.25799},
{0.06771, 0.25822},
{0.06787, 0.25845},
{0.06803, 0.25867},
{0.06818, 0.25889},
{0.06833, 0.2591},
{0.06848, 0.25931},
{0.06862, 0.25951},
{0.06876, 0.25971},
{0.0689, 0.25991},
{0.06904, 0.2601},
{0.06917, 0.26029},
{0.0693, 0.26047},
{0.06943, 0.26065},
{0.06955, 0.26082},
{0.06967, 0.26099},
{0.06979, 0.26115},
{0.06991, 0.26131},
{0.07002, 0.26147},
{0.07013, 0.26162},
{0.07024, 0.26177},
{0.07034, 0.26191},
{0.07044, 0.26205},
{0.07054, 0.26219},
{0.07064, 0.26232},
{0.07073, 0.26245},
{0.07082, 0.26257},
{0.07091, 0.26269},
{0.071, 0.26281},
{0.07108, 0.26292},
{0.07116, 0.26303},
{0.07124, 0.26314},
{0.07131, 0.26324},
{0.07138, 0.26334},
{0.07145, 0.26343},
{0.07152, 0.26352},
{0.07159, 0.26361},
{0.07165, 0.26369},
{0.07171, 0.26377},
{0.07177, 0.26385},
{0.07183, 0.26392},
{0.07188, 0.26399},
{0.07193, 0.26406},
{0.07198, 0.26413},
{0.07203, 0.26419},
{0.07208, 0.26425},
{0.07212, 0.26431},
{0.07216, 0.26436},
{0.0722, 0.26441},
{0.07224, 0.26446},
{0.07227, 0.26451},
{0.0723, 0.26455},
{0.07233, 0.26459},
{0.07236, 0.26463},
{0.07239, 0.26467},
{0.07242, 0.2647},
{0.07244, 0.26473},
{0.07246, 0.26476},
{0.07248, 0.26479},
{0.0725, 0.26482},
{0.07252, 0.26484},
{0.07254, 0.26486},
{0.07255, 0.26488},
{0.07256, 0.2649},
{0.07257, 0.26492},
{0.07258, 0.26493},
{0.07259, 0.26494},
{0.0726, 0.26495},
{0.07261, 0.26496},
{0.07262, 0.26497},
{0.07263, 0.26498},
{0.07264, 0.26499},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07264, 0.265},
{0.07265, 0.26499},
{0.07266, 0.26498},
{0.07267, 0.26497},
{0.07268, 0.26496},
{0.0727, 0.26494},
{0.07272, 0.26492},
{0.07274, 0.2649},
{0.07276, 0.26488},
{0.07279, 0.26485},
{0.07282, 0.26481},
{0.07286, 0.26477},
{0.0729, 0.26473},
{0.07295, 0.26468},
{0.073, 0.26462},
{0.07306, 0.26456},
{0.07313, 0.26449},
{0.0732, 0.26442},
{0.07328, 0.26434},
{0.07336, 0.26425},
{0.07345, 0.26415},
{0.07355, 0.26404},
{0.07366, 0.26393},
{0.07377, 0.26381},
{0.07389, 0.26368},
{0.07402, 0.26354},
{0.07416, 0.26339},
{0.07431, 0.26323},
{0.07446, 0.26307},
{0.07463, 0.2629},
{0.0748, 0.26272},
{0.07498, 0.26252},
{0.07517, 0.26232},
{0.07537, 0.2621},
{0.07558, 0.26187},
{0.0758, 0.26163},
{0.07603, 0.26138},
{0.07628, 0.26112},
{0.07653, 0.26085},
{0.0768, 0.26057},
{0.07708, 0.26028},
{0.07737, 0.25997},
{0.07767, 0.25965},
{0.07798, 0.25932},
{0.0783, 0.25898},
{0.07864, 0.25862},
{0.07899, 0.25825},
{0.07935, 0.25787},
{0.07972, 0.25747},
{0.0801, 0.25706},
{0.0805, 0.25664},
{0.08091, 0.2562},
{0.08133, 0.25575},
{0.08177, 0.25529},
{0.08222, 0.25481},
{0.08268, 0.25432},
{0.08315, 0.25381},
{0.08364, 0.25329},
{0.08414, 0.25275},
{0.08466, 0.2522},
{0.08519, 0.25163},
{0.08574, 0.25105},
{0.0863, 0.25045},
{0.08687, 0.24984},
{0.08746, 0.24921},
{0.08806, 0.24857},
{0.08868, 0.24791},
{0.08931, 0.24724},
{0.08996, 0.24655},
{0.09062, 0.24584},
{0.0913, 0.24511},
{0.09199, 0.24437},
{0.09269, 0.24361},
{0.09341, 0.24284},
{0.09415, 0.24205},
{0.0949, 0.24124},
{0.09566, 0.24042},
{0.09644, 0.23958},
{0.09723, 0.23872},
{0.09804, 0.23784},
{0.09886, 0.23695},
{0.0997, 0.23604},
{0.10056, 0.23511},
{0.10143, 0.23417},
{0.10232, 0.23321},
{0.10322, 0.23223},
{0.10414, 0.23123},
{0.10507, 0.23022},
{0.10602, 0.22919},
{0.10698, 0.22814},
{0.10796, 0.22707},
{0.10896, 0.22598},
{0.10997, 0.22488},
{0.111, 0.22376},
{0.11204, 0.22262},
{0.1131, 0.22146},
{0.11418, 0.22028},
{0.11527, 0.21909},
{0.11638, 0.21788},
{0.1175, 0.21665},
{0.11864, 0.2154},
{0.1198, 0.21413},
{0.12097, 0.21285},
{0.12216, 0.21154},
{0.12336, 0.21022},
{0.12458, 0.20888},
{0.12581, 0.20752},
{0.12706, 0.20614},
{0.12833, 0.20474},
{0.12961, 0.20333},
{0.1309, 0.2019},
{0.13221, 0.20045},
{0.13354, 0.19898},
{0.13488, 0.19749},
{0.13624, 0.19598},
{0.13761, 0.19445},
{0.139, 0.19291},
{0.1404, 0.19135},
{0.14182, 0.18977},
{0.14325, 0.18817},
{0.1447, 0.18655},
{0.14617, 0.18491},
{0.14765, 0.18325},
{0.14914, 0.18157},
{0.15065, 0.17988},
{0.15217, 0.17817},
{0.15371, 0.17644},
{0.15526, 0.17469},
{0.15683, 0.17292},
{0.15841, 0.17113},
{0.16001, 0.16932},
{0.16162, 0.1675},
{0.16325, 0.16566},
{0.16489, 0.1638},
{0.16655, 0.16192},
{0.16822, 0.16002},
{0.16991, 0.1581},
{0.17161, 0.15616},
{0.17332, 0.15421},
{0.17505, 0.15224},
{0.17679, 0.15025},
{0.17854, 0.14824},
{0.18031, 0.14621},
{0.18209, 0.14416},
{0.18388, 0.1421},
{0.18569, 0.14002},
{0.18751, 0.13792},
{0.18935, 0.1358},
{0.1912, 0.13366},
{0.19306, 0.13151},
{0.19493, 0.12934},
{0.19682, 0.12715},
{0.19872, 0.12494},
{0.20064, 0.12271},
{0.20257, 0.12047},
{0.20451, 0.11821},
{0.20646, 0.11593},
{0.20842, 0.11364},
{0.2104, 0.11133},
{0.21239, 0.109},
{0.21439, 0.10666},
{0.21641, 0.10429},
{0.21844, 0.10191},
{0.22048, 0.09951},
{0.22253, 0.09709},
{0.22459, 0.09466},
{0.22666, 0.09221},
{0.22874, 0.08974},
{0.23084, 0.08726},
{0.23295, 0.08476},
{0.23507, 0.08224},
{0.2372, 0.07971},
{0.23934, 0.07716},
{0.24149, 0.07459},
{0.24365, 0.07201},
{0.24582, 0.06941},
{0.248, 0.06679},
{0.25019, 0.06416},
{0.25239, 0.06151},
{0.2546, 0.05885},
{0.25682, 0.05617},
{0.25905, 0.05347},
{0.26129, 0.05076},
{0.26354, 0.04803},
{0.2658, 0.04529},
{0.26807, 0.04253},
{0.27035, 0.03976},
{0.27264, 0.03697},
{0.27494, 0.03416},
{0.27725, 0.03134},
{0.27957, 0.02851},
{0.2819, 0.02566},
{0.28423, 0.0228},
{0.28657, 0.01992},
{0.28892, 0.01703},
{0.29128, 0.01412},
{0.29365, 0.0112},
{0.29602, 0.00826},
{0.2984, 0.00531},
{0.30079, 0.00235},
{0.30319, -0.00063},
{0.3056, -0.00362},
{0.30801, -0.00662},
{0.31043, -0.00964},
{0.31286, -0.01267},
{0.31529, -0.01572},
{0.31773, -0.01878},
{0.32018, -0.02185},
{0.32264, -0.02494},
{0.3251, -0.02803},
{0.32757, -0.03114},
{0.33004, -0.03426},
{0.33252, -0.0374},
{0.33501, -0.04055},
{0.3375, -0.04371},
{0.34, -0.04688},
{0.3425, -0.05006},
{0.34501, -0.05326},
{0.34752, -0.05646},
{0.35004, -0.05968},
{0.35257, -0.06291},
{0.3551, -0.06615},
{0.35763, -0.0694},
{0.36017, -0.07266},
{0.36271, -0.07593},
{0.36526, -0.07922},
{0.36781, -0.08251},
{0.37037, -0.08582},
{0.37293, -0.08913},
{0.3755, -0.09246},
{0.37807, -0.0958},
{0.38064, -0.09914},
{0.38322, -0.10249},
{0.3858, -0.10585},
{0.38838, -0.10922},
{0.39097, -0.1126},
{0.39356, -0.11599},
{0.39616, -0.11939},
{0.39876, -0.1228},
{0.40136, -0.12622},
{0.40396, -0.12965},
{0.40656, -0.13308},
{0.40917, -0.13652},
{0.41178, -0.13997},
{0.41439, -0.14343},
{0.417, -0.1469},
{0.41961, -0.15037},
{0.42223, -0.15385},
{0.42485, -0.15734},
{0.42747, -0.16083},
{0.43009, -0.16433},
{0.43271, -0.16783},
{0.43533, -0.17134},
{0.43796, -0.17486},
{0.44058, -0.17838},
{0.44321, -0.18191},
{0.44584, -0.18545},
{0.44847, -0.18899},
{0.4511, -0.19253},
{0.45373, -0.19608},
{0.45636, -0.19964},
{0.45899, -0.2032},
{0.46162, -0.20676},
{0.46425, -0.21033},
{0.46687, -0.2139},
{0.4695, -0.21748},
{0.47212, -0.22106},
{0.47474, -0.22464},
{0.47736, -0.22823},
{0.47998, -0.23182},
{0.4826, -0.23541},
{0.48522, -0.23901},
{0.48784, -0.24261},
{0.49046, -0.24621},
{0.49307, -0.24981},
{0.49568, -0.25342},
{0.49829, -0.25702},
{0.5009, -0.26063},
{0.50351, -0.26424},
{0.50611, -0.26785},
{0.50871, -0.27146},
{0.51131, -0.27507},
{0.51391, -0.27868},
{0.5165, -0.28229},
{0.51909, -0.2859},
{0.52168, -0.28951},
{0.52426, -0.29312},
{0.52684, -0.29673},
{0.52941, -0.30034},
{0.53198, -0.30395},
{0.53455, -0.30756},
{0.53711, -0.31116},
{0.53967, -0.31476},
{0.54222, -0.31836},
{0.54477, -0.32196},
{0.54731, -0.32556},
{0.54985, -0.32915},
{0.55238, -0.33274},
{0.55491, -0.33633},
{0.55743, -0.33992},
{0.55995, -0.3435},
{0.56246, -0.34708},
{0.56497, -0.35065},
{0.56747, -0.35422},
{0.56996, -0.35778},
{0.57245, -0.36134},
{0.57493, -0.36489},
{0.5774, -0.36844},
{0.57987, -0.37198},
{0.58233, -0.37552},
{0.58478, -0.37905},
{0.58723, -0.38257},
{0.58967, -0.38609},
{0.5921, -0.3896},
{0.59452, -0.3931},
{0.59694, -0.3966},
{0.59935, -0.40009},
{0.60175, -0.40357},
{0.60415, -0.40704},
{0.60653, -0.4105},
{0.60891, -0.41395},
{0.61128, -0.4174},
{0.61364, -0.42084},
{0.61599, -0.42426},
{0.61833, -0.42768},
{0.62066, -0.43108},
{0.62298, -0.43448},
{0.62529, -0.43786},
{0.62759, -0.44123},
{0.62989, -0.44459},
{0.63217, -0.44794},
{0.63445, -0.45128},
{0.63671, -0.45461},
{0.63896, -0.45792},
{0.6412, -0.46122},
{0.64343, -0.46451},
{0.64565, -0.46779},
{0.64786, -0.47106},
{0.65006, -0.47431},
{0.65225, -0.47755},
{0.65443, -0.48077},
{0.6566, -0.48398},
{0.65875, -0.48717},
{0.66089, -0.49035},
{0.66302, -0.49351},
{0.66514, -0.49666},
{0.66724, -0.49979},
{0.66933, -0.50291},
{0.67141, -0.50601},
{0.67348, -0.50909},
{0.67553, -0.51216},
{0.67757, -0.51521},
{0.6796, -0.51824},
{0.68162, -0.52126},
{0.68362, -0.52426},
{0.68561, -0.52724},
{0.68759, -0.5302},
{0.68955, -0.53314},
{0.6915, -0.53606},
{0.69343, -0.53896},
{0.69535, -0.54185},
{0.69725, -0.54472},
{0.69914, -0.54757},
{0.70101, -0.5504},
{0.70287, -0.55321},
{0.70471, -0.55599},
{0.70654, -0.55875},
{0.70836, -0.56149},
{0.71016, -0.56421},
{0.71195, -0.56691},
{0.71372, -0.56959},
{0.71547, -0.57224},
{0.71721, -0.57488},
{0.71893, -0.57749},
{0.72063, -0.58008},
{0.72232, -0.58265},
{0.72399, -0.58519},
{0.72565, -0.58771},
{0.72729, -0.5902},
{0.72891, -0.59267},
{0.73051, -0.59511},
{0.7321, -0.59753},
{0.73367, -0.59993},
{0.73522, -0.6023},
{0.73676, -0.60465},
{0.73828, -0.60697},
{0.73978, -0.60927},
{0.74127, -0.61154},
{0.74274, -0.61378},
{0.74419, -0.616},
{0.74562, -0.61819},
{0.74703, -0.62036},
{0.74843, -0.62251},
{0.74981, -0.62462},
{0.75117, -0.62671},
{0.75251, -0.62877},
{0.75383, -0.6308},
{0.75514, -0.63281},
{0.75643, -0.63479},
{0.7577, -0.63674},
{0.75895, -0.63867},
{0.76018, -0.64057},
{0.7614, -0.64244},
{0.7626, -0.64428},
{0.76378, -0.64609},
{0.76494, -0.64788},
{0.76608, -0.64964},
{0.7672, -0.65137},
{0.7683, -0.65308},
{0.76938, -0.65476},
{0.77044, -0.65641},
{0.77149, -0.65803},
{0.77252, -0.65962},
{0.77353, -0.66119},
{0.77452, -0.66272},
{0.77549, -0.66422},
{0.77645, -0.6657},
{0.77738, -0.66715},
{0.7783, -0.66857},
{0.7792, -0.66996},
{0.78008, -0.67133},
{0.78094, -0.67267},
{0.78178, -0.67398},
{0.7826, -0.67526},
{0.78341, -0.67651},
{0.7842, -0.67773},
{0.78497, -0.67893},
{0.78572, -0.6801},
{0.78645, -0.68124},
{0.78717, -0.68236},
{0.78787, -0.68344},
{0.78855, -0.6845},
{0.78921, -0.68553},
{0.78986, -0.68654},
{0.79049, -0.68752},
{0.7911, -0.68847},
{0.79169, -0.6894},
{0.79227, -0.6903},
{0.79283, -0.69118},
{0.79337, -0.69203},
{0.7939, -0.69285},
{0.79441, -0.69364},
{0.79491, -0.69441},
{0.79538, -0.69515},
{0.79584, -0.69587},
{0.79629, -0.69657},
{0.79672, -0.69724},
{0.79713, -0.69788},
{0.79753, -0.6985},
{0.79792, -0.6991},
{0.79829, -0.69968},
{0.79864, -0.70023},
{0.79898, -0.70076},
{0.79931, -0.70127},
{0.79962, -0.70175},
{0.79992, -0.70222},
{0.8002, -0.70266},
{0.80047, -0.70309},
{0.80073, -0.70349},
{0.80098, -0.70388},
{0.80121, -0.70424},
{0.80143, -0.70459},
{0.80164, -0.70491},
{0.80184, -0.70522},
{0.80203, -0.70551},
{0.8022, -0.70578},
{0.80237, -0.70604},
{0.80252, -0.70628},
{0.80266, -0.7065},
{0.8028, -0.70671},
{0.80292, -0.70691},
{0.80303, -0.70709},
{0.80314, -0.70726},
{0.80323, -0.70741},
{0.80332, -0.70755},
{0.8034, -0.70767},
{0.80347, -0.70778},
{0.80353, -0.70788},
{0.80359, -0.70797},
{0.80364, -0.70805},
{0.80369, -0.70812},
{0.80373, -0.70819},
{0.80376, -0.70824},
{0.80379, -0.70829},
{0.80381, -0.70833},
{0.80383, -0.70837},
{0.80385, -0.7084},
{0.80386, -0.70842},
{0.80387, -0.70844},
{0.80388, -0.70845},
{0.80388, -0.70846},
{0.80388, -0.70846},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70847},
{0.80388, -0.70846},
{0.80388, -0.70845},
{0.80388, -0.70844},
{0.80388, -0.70843},
{0.80388, -0.70841},
{0.80389, -0.70839},
{0.8039, -0.70837},
{0.80391, -0.70834},
{0.80392, -0.70831},
{0.80393, -0.70827},
{0.80394, -0.70823},
{0.80395, -0.70818},
{0.80396, -0.70813},
{0.80397, -0.70807},
{0.80398, -0.70801},
{0.804, -0.70794},
{0.80402, -0.70787},
{0.80404, -0.70779},
{0.80406, -0.70771},
{0.80408, -0.70762},
{0.8041, -0.70752},
{0.80413, -0.70741},
{0.80416, -0.7073},
{0.80419, -0.70718},
{0.80422, -0.70705},
{0.80425, -0.70691},
{0.80428, -0.70676},
{0.80432, -0.7066},
{0.80436, -0.70644},
{0.8044, -0.70627},
{0.80444, -0.70609},
{0.80448, -0.7059},
{0.80453, -0.7057},
{0.80458, -0.70549},
{0.80463, -0.70527},
{0.80468, -0.70504},
{0.80474, -0.7048},
{0.8048, -0.70455},
{0.80486, -0.70429},
{0.80492, -0.70402},
{0.80499, -0.70374},
{0.80506, -0.70345},
{0.80513, -0.70315},
{0.8052, -0.70284},
{0.80528, -0.70252},
{0.80536, -0.70218},
{0.80544, -0.70183},
{0.80553, -0.70147},
{0.80562, -0.7011},
{0.80571, -0.70072},
{0.80581, -0.70033},
{0.80591, -0.69993},
{0.80601, -0.69951},
{0.80612, -0.69908},
{0.80623, -0.69864},
{0.80634, -0.69819},
{0.80646, -0.69773},
{0.80658, -0.69726},
{0.8067, -0.69677},
{0.80683, -0.69627},
{0.80696, -0.69576},
{0.8071, -0.69524},
{0.80724, -0.69471},
{0.80739, -0.69416},
{0.80754, -0.6936},
{0.80769, -0.69303},
{0.80785, -0.69245},
{0.80801, -0.69185},
{0.80818, -0.69125},
{0.80835, -0.69063},
{0.80853, -0.69},
{0.80871, -0.68936},
{0.8089, -0.68871},
{0.80909, -0.68805},
{0.80929, -0.68737},
{0.80949, -0.68668},
{0.8097, -0.68598},
{0.80991, -0.68527},
{0.81013, -0.68455},
{0.81035, -0.68382},
{0.81058, -0.68307},
{0.81082, -0.68232},
{0.81106, -0.68155},
{0.81131, -0.68077},
{0.81156, -0.67998},
{0.81182, -0.67918},
{0.81209, -0.67837},
{0.81236, -0.67755},
{0.81264, -0.67672},
{0.81293, -0.67588},
{0.81322, -0.67503},
{0.81352, -0.67417},
{0.81383, -0.6733},
{0.81414, -0.67242},
{0.81446, -0.67153},
{0.81479, -0.67063},
{0.81513, -0.66972},
{0.81547, -0.6688},
{0.81582, -0.66787},
{0.81618, -0.66693},
{0.81655, -0.66598},
{0.81693, -0.66503},
{0.81731, -0.66407},
{0.8177, -0.6631},
{0.8181, -0.66212},
{0.81851, -0.66113},
{0.81893, -0.66014},
{0.81936, -0.65914},
{0.81979, -0.65813},
{0.82023, -0.65711},
{0.82068, -0.65609},
{0.82114, -0.65506},
{0.82161, -0.65403},
{0.82209, -0.65299},
{0.82258, -0.65194},
{0.82308, -0.65089},
{0.82359, -0.64983},
{0.82411, -0.64877},
{0.82464, -0.6477},
{0.82518, -0.64663},
{0.82573, -0.64555},
{0.82629, -0.64447},
{0.82686, -0.64338},
{0.82744, -0.64229},
{0.82803, -0.6412},
{0.82863, -0.6401},
{0.82924, -0.639},
{0.82986, -0.6379},
{0.83049, -0.63679},
{0.83113, -0.63568},
{0.83179, -0.63457},
{0.83246, -0.63346},
{0.83314, -0.63234},
{0.83383, -0.63122},
{0.83453, -0.6301},
{0.83524, -0.62898},
{0.83597, -0.62786},
{0.83671, -0.62674},
{0.83746, -0.62562},
{0.83822, -0.6245},
{0.83899, -0.62338},
{0.83978, -0.62226},
{0.84058, -0.62114},
{0.84139, -0.62002},
{0.84221, -0.6189},
{0.84305, -0.61778},
{0.8439, -0.61667},
{0.84476, -0.61556},
{0.84564, -0.61445},
{0.84653, -0.61334},
{0.84743, -0.61224},
{0.84834, -0.61114},
{0.84927, -0.61004},
{0.85021, -0.60895},
{0.85116, -0.60786},
{0.85213, -0.60677},
{0.85311, -0.60569},
{0.8541, -0.60461},
{0.85511, -0.60354},
{0.85613, -0.60247},
{0.85717, -0.60141},
{0.85822, -0.60035},
{0.85928, -0.5993},
{0.86036, -0.59825},
{0.86145, -0.59721},
{0.86256, -0.59617},
{0.86368, -0.59514},
{0.86481, -0.59412},
{0.86596, -0.59311},
{0.86712, -0.5921},
{0.8683, -0.5911},
{0.86949, -0.59011},
{0.8707, -0.58913},
{0.87192, -0.58815},
{0.87315, -0.58718},
{0.8744, -0.58622},
{0.87566, -0.58527},
{0.87694, -0.58433},
{0.87823, -0.5834},
{0.87954, -0.58248},
{0.88086, -0.58157},
{0.8822, -0.58067},
{0.88355, -0.57978},
{0.88491, -0.5789},
{0.88629, -0.57803},
{0.88768, -0.57717},
{0.88909, -0.57632},
{0.89051, -0.57548},
{0.89195, -0.57465},
{0.8934, -0.57383},
{0.89487, -0.57303},
{0.89635, -0.57224},
{0.89785, -0.57146},
{0.89936, -0.57069},
{0.90089, -0.56993},
{0.90243, -0.56919},
{0.90398, -0.56846},
{0.90555, -0.56774},
{0.90713, -0.56704},
{0.90873, -0.56635},
{0.91034, -0.56567},
{0.91197, -0.56501},
{0.91361, -0.56436},
{0.91526, -0.56372},
{0.91693, -0.5631},
{0.91861, -0.56249},
{0.92031, -0.5619},
{0.92202, -0.56132},
{0.92374, -0.56075},
{0.92548, -0.5602},
{0.92723, -0.55966},
{0.92899, -0.55914},
{0.93077, -0.55863},
{0.93256, -0.55814},
{0.93436, -0.55766},
{0.93618, -0.5572},
{0.93801, -0.55675},
{0.93985, -0.55632},
{0.94171, -0.55591},
{0.94358, -0.55551},
{0.94546, -0.55513},
{0.94736, -0.55476},
{0.94927, -0.55441},
{0.95119, -0.55407},
{0.95312, -0.55375},
{0.95507, -0.55345},
{0.95703, -0.55316},
{0.959, -0.55289},
{0.96098, -0.55264},
{0.96297, -0.5524},
{0.96498, -0.55218},
{0.967, -0.55198},
{0.96903, -0.55179},
{0.97107, -0.55162},
{0.97312, -0.55147},
{0.97518, -0.55133},
{0.97725, -0.55121},
{0.97933, -0.55111},
{0.98143, -0.55102},
{0.98354, -0.55095},
{0.98566, -0.5509},
{0.98779, -0.55086},
{0.98992, -0.55084},
{0.99207, -0.55084},
{0.99422, -0.55085},
{0.99639, -0.55088},
{0.99857, -0.55093},
{1.00075, -0.55099},
{1.00294, -0.55107},
{1.00514, -0.55117},
{1.00735, -0.55129},
{1.00957, -0.55142},
{1.0118, -0.55157},
{1.01404, -0.55174},
{1.01628, -0.55192},
{1.01853, -0.55212},
{1.02079, -0.55234},
{1.02306, -0.55257},
{1.02533, -0.55282},
{1.02761, -0.55308},
{1.0299, -0.55336},
{1.0322, -0.55366},
{1.0345, -0.55397},
{1.03681, -0.5543},
{1.03912, -0.55465},
{1.04144, -0.55501},
{1.04377, -0.55539},
{1.0461, -0.55578},
{1.04844, -0.55619},
{1.05078, -0.55661},
{1.05313, -0.55705},
{1.05548, -0.55751},
{1.05783, -0.55798},
{1.06019, -0.55847},
{1.06255, -0.55897},
{1.06492, -0.55949},
{1.06729, -0.56002},
{1.06967, -0.56057},
{1.07205, -0.56113},
{1.07443, -0.56171},
{1.07682, -0.5623},
{1.07921, -0.5629},
{1.0816, -0.56352},
{1.08399, -0.56415},
{1.08638, -0.5648},
{1.08878, -0.56546},
{1.09118, -0.56613},
{1.09358, -0.56682},
{1.09598, -0.56752},
{1.09838, -0.56823},
{1.10078, -0.56896},
{1.10318, -0.5697},
{1.10558, -0.57045},
{1.10798, -0.57121},
{1.11038, -0.57199},
{1.11278, -0.57278},
{1.11518, -0.57358},
{1.11758, -0.57439},
{1.11998, -0.57521},
{1.12237, -0.57604},
{1.12477, -0.57689},
{1.12716, -0.57775},
{1.12955, -0.57862},
{1.13194, -0.5795},
{1.13433, -0.58039},
{1.13671, -0.58129},
{1.13909, -0.5822},
{1.14146, -0.58312},
{1.14383, -0.58405},
{1.1462, -0.58499},
{1.14856, -0.58594},
{1.15092, -0.58689},
{1.15328, -0.58785},
{1.15563, -0.58882},
{1.15797, -0.5898},
{1.16031, -0.59079},
{1.16265, -0.59179},
{1.16498, -0.59279},
{1.1673, -0.5938},
{1.16962, -0.59482},
{1.17193, -0.59584},
{1.17424, -0.59687},
{1.17654, -0.59791},
{1.17883, -0.59895},
{1.18111, -0.6},
{1.18339, -0.60106},
{1.18566, -0.60212},
{1.18792, -0.60319},
{1.19017, -0.60426},
{1.19241, -0.60534},
{1.19465, -0.60642},
{1.19688, -0.60751},
{1.1991, -0.6086},
{1.20131, -0.60969},
{1.20351, -0.61079},
{1.2057, -0.61189},
{1.20788, -0.61299},
{1.21005, -0.6141},
{1.21221, -0.61521},
{1.21436, -0.61632},
{1.2165, -0.61743},
{1.21863, -0.61854},
{1.22075, -0.61966},
{1.22286, -0.62078},
{1.22495, -0.6219},
{1.22703, -0.62302},
{1.2291, -0.62414},
{1.23116, -0.62526},
{1.23321, -0.62638},
{1.23524, -0.6275},
{1.23726, -0.62862},
{1.23927, -0.62974},
{1.24126, -0.63086},
{1.24324, -0.63198},
{1.24521, -0.63309},
{1.24717, -0.6342},
{1.24911, -0.63531},
{1.25104, -0.63642},
{1.25295, -0.63753},
{1.25485, -0.63863},
{1.25673, -0.63973},
{1.2586, -0.64083},
{1.26045, -0.64192},
{1.26229, -0.64301},
{1.26411, -0.6441},
{1.26592, -0.64518},
{1.26771, -0.64626},
{1.26949, -0.64733},
{1.27125, -0.6484},
{1.273, -0.64946},
{1.27473, -0.65052},
{1.27645, -0.65157},
{1.27815, -0.65262},
{1.27983, -0.65366},
{1.28149, -0.6547},
{1.28314, -0.65573},
{1.28477, -0.65675},
{1.28639, -0.65777},
{1.28799, -0.65878},
{1.28957, -0.65978},
{1.29114, -0.66078},
{1.29269, -0.66177},
{1.29422, -0.66275},
{1.29573, -0.66372},
{1.29722, -0.66468},
{1.2987, -0.66564},
{1.30016, -0.66659},
{1.3016, -0.66753},
{1.30303, -0.66846},
{1.30444, -0.66938},
{1.30583, -0.67029},
{1.3072, -0.67119},
{1.30855, -0.67208},
{1.30988, -0.67296},
{1.31119, -0.67383},
{1.31249, -0.6747},
{1.31377, -0.67555},
{1.31503, -0.67639},
{1.31627, -0.67722},
{1.31749, -0.67804},
{1.31869, -0.67885},
{1.31988, -0.67965},
{1.32105, -0.68044},
{1.3222, -0.68122},
{1.32333, -0.68199},
{1.32444, -0.68275},
{1.32553, -0.6835},
{1.3266, -0.68424},
{1.32765, -0.68497},
{1.32868, -0.68568},
{1.3297, -0.68638},
{1.3307, -0.68707},
{1.33168, -0.68775},
{1.33264, -0.68842},
{1.33358, -0.68908},
{1.3345, -0.68973},
{1.3354, -0.69036},
{1.33629, -0.69098},
{1.33715, -0.69159},
{1.338, -0.69219},
{1.33883, -0.69278},
{1.33964, -0.69335},
{1.34043, -0.69391},
{1.34121, -0.69446},
{1.34197, -0.695},
{1.34271, -0.69553},
{1.34343, -0.69604},
{1.34413, -0.69654},
{1.34482, -0.69703},
{1.34549, -0.69751},
{1.34614, -0.69798},
{1.34677, -0.69843},
{1.34739, -0.69887},
{1.34799, -0.6993},
{1.34857, -0.69972},
{1.34914, -0.70013},
{1.34969, -0.70053},
{1.35022, -0.70091},
{1.35074, -0.70128},
{1.35124, -0.70164},
{1.35173, -0.70199},
{1.3522, -0.70233},
{1.35265, -0.70266},
{1.35309, -0.70298},
{1.35351, -0.70329},
{1.35391, -0.70358},
{1.3543, -0.70387},
{1.35468, -0.70414},
{1.35504, -0.7044},
{1.35539, -0.70465},
{1.35572, -0.70489},
{1.35604, -0.70512},
{1.35634, -0.70534},
{1.35663, -0.70555},
{1.35691, -0.70575},
{1.35718, -0.70595},
{1.35743, -0.70614},
{1.35767, -0.70632},
{1.3579, -0.70649},
{1.35812, -0.70665},
{1.35832, -0.7068},
{1.35851, -0.70694},
{1.35869, -0.70707},
{1.35886, -0.7072},
{1.35902, -0.70732},
{1.35917, -0.70743},
{1.35931, -0.70753},
{1.35944, -0.70763},
{1.35956, -0.70772},
{1.35967, -0.7078},
{1.35977, -0.70788},
{1.35986, -0.70795},
{1.35995, -0.70802},
{1.36003, -0.70808},
{1.3601, -0.70813},
{1.36016, -0.70818},
{1.36022, -0.70822},
{1.36027, -0.70826},
{1.36031, -0.70829},
{1.36035, -0.70832},
{1.36038, -0.70835},
{1.36041, -0.70837},
{1.36043, -0.70839},
{1.36045, -0.70841},
{1.36047, -0.70842},
{1.36048, -0.70843},
{1.36049, -0.70844},
{1.3605, -0.70845},
{1.36051, -0.70846},
{1.36051, -0.70846},
{1.36051, -0.70846},
{1.36051, -0.70846}
};


int i = 0;
void setup()
{
  Serial.begin(115200);

//--------------------Joint 1----------------------------------------------------//  
  Wire.begin();           //start i2C
  Wire.setClock(800000L); // faster clock for the encoder (so that we can read from it faster).
  Wire.setPins(SDA, SCL);

  Wire1.begin();
  Wire1.setClock(800000L);
  Wire1.setPins(SDA_2, SCL_2);
  
  //Motor encoder-related ( for one joint)
  as5600.begin();  //  start as5600 encoder.
  as5600.setDirection(AS5600_CLOCK_WISE);
  Serial.print("Connect device 1: ");
  Serial.println(as5600.isConnected() ? "true" : "false");
  delay(1000);

//  as5600_2.begin();  //  set direction pin.
//  as5600_2.setDirection(AS5600_COUNTERCLOCK_WISE);
//  Serial.println("Connect device 2: ");
//  Serial.println(as5600_2.isConnected() ? "true" : "false");
//  delay(1000);

  stepper1.setMaxSpeed(32000); // stepper1.setMaxSpeed(200) // if the stepper driver is in full step mode this means the max is 200 steps per second.
  stepper1.setAcceleration(15000); //100 steps per second square.

  float initialize[2] = {0.0, 0.0};

  while(as5600.readAngle()*0.08789 > 1){
    move_motors(initialize);  
  }
  

//------------------------------------------------------------------------------//

//--------------------Joint 2 via can bus---------------------------------------//  


 
//------------------------------------------------------------------------------//
}

void loop()
{ 
 
  globalAngles[0] = preloaded_trajectory[i][0]*57.2958;
  globalAngles[1] = preloaded_trajectory[i][1]*57.2958;
  if (i < 1498){
    i++;
  }
  move_motors(globalAngles);
  delay(1);
}

void move_motors(float angles[2])
{
  
  // set up current target.
  float j1Target = angles[0];
//  float j2Target = angles[1];

Serial.print("Target : ");
Serial.print(j1Target);

  // get encoder reading for both joints
  float j1CurrPosition = as5600.readAngle()*0.08789; // scale to degrees
//  float j2CurrPosition = as5600.readAngle()*0.08789; // to be changed

//Serial.print(" Position : ");
Serial.print(",");

Serial.print(" Position : ");
Serial.print(j1CurrPosition);

  // PID algorithm j1
  float control1 = calculatePID(j1CurrPosition,j1Target,1);
  // PID algorithm j2
//  float control2 = calculatePID(j2CurrPosition, j2Target)

  Serial.println();
  driveMotor(stepper1, control1); //changes to use Accel stepper library
//  driveMotor(stepper2, control2);
}

float calculatePID(float currPosition, float Target, int jointNum)
{
  cT[jointNum-1] = micros();//current time
  dT[jointNum-1] = (cT[jointNum-1] - pT[jointNum-1]) / 1000000.0; //time difference in seconds
  pT[jointNum-1] = cT[jointNum-1]; //save the current time for the next iteration to get the time difference
  eV[jointNum-1] = currPosition - Target; //Current position - target position (or setpoint)
  ed[jointNum-1] = (eV[jointNum-1] - pE[jointNum-1]) / dT[jointNum-1]; //edot = de/dt - derivative term
  eI[jointNum-1] = eI[jointNum-1] + (eV[jointNum-1] +pE[jointNum-1]) * dT[jointNum-1]/2; //integral term - Newton-Leibniz, notice, this is a running sum!6
  controlSignal = (proportional * eV[jointNum-1]) + (derivative * ed[jointNum-1]) + (integral * eI[jointNum-1]); //final sum, proportional term also calculated here
  pE[jointNum-1] = eV[jointNum-1]; //save the error for the next iteration to get the difference (for edot)
  
//  Serial.print(", ");
//  Serial.print(controlSignal);
  return controlSignal;
}
  
void driveMotor(AccelStepper stepper, float controlSignal)
{
  if(fabs(controlSignal) > 20) // currently set to within +/- 5 steps
  {
    stepper.setSpeed(controlSignal*1000);
  }
  else
  {
    stepper.setSpeed(0);
    stepper.stop();
  }

   stepper.runSpeed();
}
